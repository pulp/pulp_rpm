Implement `nested_by_digest` and `nested_by_both` and cache-friendly repo layout options.