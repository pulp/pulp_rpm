# WARNING: DO NOT EDIT!
#
# This file was generated by plugin_template, and is managed by it. Please use
# './plugin-template --travis pulp_rpm' to update this file.
#
# For more info visit https://github.com/pulp/plugin_template
---
sudo: required
# https://docs.travis-ci.com/user/trusty-ci-environment/
dist: bionic
language: python
python:
  # Fedora has 3.6 available (python36.x86_64), but pulp container images
  # with it are not being built or published yet.
  # - "3.6"
  - "3.7"
env:
  matrix:
    - TEST=pulp
    - TEST=docs
    - TEST=s3
services:
  - docker
addons:
  apt:
    packages:
      - httpie
      - jq
before_install: .travis/before_install.sh
install: .travis/install.sh
before_script: .travis/before_script.sh
script: .travis/script.sh
after_failure:
  - http --timeout 30 --check-status --pretty format --print hb http://pulp/pulp/api/v3/status/
  - docker images
  - docker ps -a
  - docker logs pulp
  - docker exec pulp ls -latr /etc/yum.repos.d/
  - docker exec pulp cat /etc/yum.repos.d/*
jobs:
  include:
    - stage: deploy
      name: "Deploy plugin to pypi"
      before_install: skip
      install: skip
      before_script: skip
      script: bash .travis/publish_plugin_pypi.sh
      if: tag IS present
    - stage: deploy
      name: "Publish client to rubygems"
      script: bash .travis/publish_client_gem.sh
      env:
        - TEST=bindings
      if: type = cron
    - stage: deploy
      name: "Publish client to pypi"
      script: bash .travis/publish_client_pypi.sh
      env:
        - TEST=bindings
      if: type = cron
    - stage: deploy
      name: "Publish client to rubygems"
      script: bash .travis/publish_client_gem.sh
      env:
        - TEST=bindings
      if: tag IS present
    - stage: deploy
      name: "Publish client to pypi"
      script: bash .travis/publish_client_pypi.sh
      env:
        - TEST=bindings
      if: tag IS present
    - stage: publish-tagged-docs
      script: bash .travis/publish_docs.sh tag
      env:
        - TEST=docs
      if: tag IS present
    - stage: publish-continuous-docs
      script: bash .travis/publish_docs.sh nightly
      env:
        - TEST=docs
      if: type != pull_request AND repo = pulp/pulp_rpm AND branch = master
    - stage: daily-performance-test
      name: "Daily sync performance test"
      env:
        - TEST=performance PERFORMANCE_TEST=sync
      if: type = cron
    - stage: daily-performance-test
      name: "Daily publish performance test"
      env:
        - TEST=performance PERFORMANCE_TEST=publish
      if: type = cron
    - stage: daily-performance-test
      name: "Daily pulp_to_pulp performance test"
      env:
        - TEST=performance PERFORMANCE_TEST=pulp_to_pulp
      if: type = cron
    - stage: update-redmine
      before_install: skip
      install: skip
      before_script: skip
      script: bash .travis/update_redmine.sh
      if: tag IS present
    - stage: cherry-pick
      if: type = cron
      before_install: skip
      install: skip
      before_script: skip
      script: bash .travis/cherrypick.sh
notifications: None

...
